# library(testthat)
# library(sdpFeatureFetcher)
# library(httr)
# library(RJSONIO)
# library(data.table)

## Full expected output for JSON output
## not a very good test because columns should change... but works for now
jsonExampleExpectedOutput <- data.table(
    legalName = c('BMG HARVEST II, INC.', 'BMG HARVEST II, INC.', 'BMG HARVEST II, INC.', 'BMG HARVEST II, INC.', 'BMG HARVEST II, INC.', 'BMG HARVEST II, INC.', 'BMG HARVEST II, INC.', 'BMG HARVEST II, INC.', 'BMG HARVEST II, INC.', 'BMG HARVEST II, INC.', 'FRENCH PASTRY SCHOOL,INC', 'FRENCH PASTRY SCHOOL,INC', 'FRENCH PASTRY SCHOOL,INC', 'FRENCH PASTRY SCHOOL,INC', 'FRENCH PASTRY SCHOOL,INC', 'FRENCH PASTRY SCHOOL,INC', 'FRENCH PASTRY SCHOOL,INC'),
    doingBusinessAsName = c('FRENCH ACCENT', 'FRENCH ACCENT', 'FRENCH ACCENT', 'FRENCH ACCENT', 'FRENCH ACCENT', 'FRENCH ACCENT', 'FRENCH ACCENT', 'FRENCH ACCENT', 'FRENCH ACCENT', 'FRENCH ACCENT', 'FRENCH PASTRY SCHOOL INC', 'FRENCH PASTRY SCHOOL INC', 'FRENCH PASTRY SCHOOL INC', 'FRENCH PASTRY SCHOOL INC', 'FRENCH PASTRY SCHOOL INC', 'FRENCH PASTRY SCHOOL INC', 'FRENCH PASTRY SCHOOL INC'),
    accountNumber = c('355130', '355130', '355130', '355130', '355130', '355130', '355130', '355130', '355130', '355130', '86330', '86330', '86330', '86330', '86330', '86330', '86330'),
    fullAddress = c('233 S WACKER DR, 2ND, CHICAGO, IL 60606 ', '233 S WACKER DR, 2ND, CHICAGO, IL 60606 ', '233 S WACKER DR, 2ND, CHICAGO, IL 60606 ', '233 S WACKER DR, 2ND, CHICAGO, IL 60606 ', '233 S WACKER DR, 2ND, CHICAGO, IL 60606 ', '233 S WACKER DR, 2ND, CHICAGO, IL 60606 ', '233 S WACKER DR, 2ND, CHICAGO, IL 60606 ', '233 S WACKER DR, 2ND, CHICAGO, IL 60606 ', '233 S WACKER DR, 2ND, CHICAGO, IL 60606 ', '233 S WACKER DR, 2ND, CHICAGO, IL 60606 ', '226 W JACKSON BLVD, CHICAGO, IL 60606 ', '226 W JACKSON BLVD, CHICAGO, IL 60606 ', '226 W JACKSON BLVD, CHICAGO, IL 60606 ', '226 W JACKSON BLVD, CHICAGO, IL 60606 ', '226 W JACKSON BLVD, CHICAGO, IL 60606 ', '226 W JACKSON BLVD, CHICAGO, IL 60606 ', '226 W JACKSON BLVD, CHICAGO, IL 60606 '),
    latitude = c(41.878560154, 41.878560154, 41.878560154, 41.878560154, 41.878560154, 41.878560154, 41.878560154, 41.878560154, 41.878560154, 41.878560154, 41.878220322, 41.878220322, 41.878220322, 41.878220322, 41.878220322, 41.878220322, 41.878220322),
    longitude = c(-87.636523872, -87.636523872, -87.636523872, -87.636523872, -87.636523872, -87.636523872, -87.636523872, -87.636523872, -87.636523872, -87.636523872, -87.634523879, -87.634523879, -87.634523879, -87.634523879, -87.634523879, -87.634523879, -87.634523879),
    inspectionId = c('463221', '463237', '614362', '1134549', '1324599', '1447302', '1447313', '1578739', '1683228', '1683239', '343418', '614436', '1313367', '1324812', '1447408', '1419080', '1683265'),
    actionDate = structure(c(14943L, 14949L, 15181L, 15596L, 15923L, 16206L, 16217L, 16716L, 16847L, 16854L, 14895L, 15210L, 15708L, 16041L, 16289L, 16622L, 16871L),
                           class = c('IDate', 'Date')),
    target = c('FAIL', 'FAIL', 'PASS', 'FAIL', 'PASS', 'FAIL', 'PASS', 'FAIL', 'PASS', 'FAIL', 'PASS', 'FAIL', 'PASS', 'FAIL', 'PASS', 'FAIL', 'PASS'),
    targetBool = c(TRUE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE),
    earliestStartDate = structure(c(14951L, 14951L, 14951L, 14951L, 14951L, 14951L, 14951L, 14951L, 14951L, 14951L, 11642L, 11642L, 11642L, 11642L, 11642L, 11642L, 11642L),
                                  class = c('IDate', 'Date')),
    ageAtActionDate = c(-8L, -2L, 230L, 645L, 972L, 1255L, 1266L, 1765L, 1896L, 1903L, 3253L, 3568L, 4066L, 4399L, 4647L, 4980L, 5229L),
    eventsPast90days = c(0L, 1L, 0L, 0L, 0L, 0L, 1L, 0L, 0L, 1L, 0L, 0L, 0L, 0L, 0L, 0L, 0L),
    eventsPast365days = c(0L, 1L, 2L, 0L, 1L, 1L, 2L, 0L, 1L, 2L, 0L, 1L, 0L, 1L, 1L, 1L, 1L),
    eventsPast730days = c(0L, 1L, 2L, 3L, 1L, 2L, 3L, 2L, 3L, 4L, 0L, 1L, 1L, 1L, 2L, 2L, 2L),
    TargetEventsPast90days = c(0L, 1L, 0L, 0L, 0L, 0L, 1L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L),
    TargetEventsPast365days = c(0L, 1L, 2L, 0L, 1L, 0L, 1L, 0L, 1L, 1L, 0L, 0L, 0L, 0L, 1L, 0L, 1L),
    TargetEventsPast730days = c(0L, 1L, 2L, 2L, 1L, 1L, 2L, 1L, 2L, 2L, 0L, 0L, 1L, 0L, 1L, 1L, 1L))

context("data parser")

test_that("full parser example", {
  sdpOutput <- sdpFeatureFetcher:::parseRecords("data/examp_mod.json")
  testthat::expect_equal(jsonExampleExpectedOutput,
                         sdpOutput)
})

